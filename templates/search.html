{% extends "base.html" %}

{% block title %}{% if query %}Search: {{ query }}{% else %}Search{% endif %} - Iron Chef Recipe Database{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col">
            <h1 class="h2 fw-bold mb-3">
                <i class="bi bi-search text-primary"></i> Search Results
            </h1>
            {% if query %}
            <p class="text-muted">Results for "<strong>{{ query }}</strong>"</p>
            {% else %}
            <p class="text-muted">Enter a search term to find episodes, dishes, and recipes</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Search Form -->
    <div class="row mb-4">
        <div class="col">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <form method="get" action="{{ url_for('search') }}">
                        <div class="input-group input-group-lg">
                            <input type="text" class="form-control" name="q" 
                                   placeholder="Search episodes, dishes, recipes, chefs, ingredients..." 
                                   value="{{ query }}" maxlength="100" autofocus>
                            <button class="btn btn-primary" type="submit">
                                <i class="bi bi-search"></i> Search
                            </button>
                        </div>
                        <div class="form-text mt-2">
                            <i class="bi bi-info-circle"></i> 
                            Search across episode themes, chef names, dish names, ingredients, and recipe titles
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    {% if results %}
    <!-- Results Summary -->
    <div class="row mb-4">
        <div class="col">
            <div class="alert alert-success border-0">
                <i class="bi bi-check-circle"></i>
                Found <strong>{{ results.total }}</strong> results: 
                {{ results.episodes|length }} episodes, 
                {{ results.dishes|length }} dishes, 
                {{ results.recipes|length }} recipes
            </div>
        </div>
    </div>
    
    <!-- Episodes Results -->
    {% if results.episodes %}
    <div class="row mb-5">
        <div class="col">
            <h3 class="h4 mb-3">
                <i class="bi bi-tv text-primary"></i> Episodes ({{ results.episodes|length }})
            </h3>
            <div class="row g-3">
                {% for episode in results.episodes %}
                <div class="col-lg-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <span class="badge bg-primary">Episode {{ episode.episode_number }}</span>
                                <small class="text-muted">Episode</small>
                            </div>
                            <h5 class="card-title">{{ episode.theme }}</h5>
                            <div class="row g-1 mb-3">
                                <div class="col-12">
                                    <small class="text-muted">
                                        <i class="bi bi-person-badge"></i> Iron Chef: {{ episode.iron_chef_name }}
                                    </small>
                                </div>
                                <div class="col-12">
                                    <small class="text-muted">
                                        <i class="bi bi-person"></i> Competitor: {{ episode.competitor_name }}
                                    </small>
                                </div>
                            </div>
                            <a href="{{ url_for('episode_detail', episode_id=episode.id) }}" 
                               class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-eye"></i> View Episode
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Dishes Results -->
    {% if results.dishes %}
    <div class="row mb-5">
        <div class="col">
            <h3 class="h4 mb-3">
                <i class="bi bi-egg-fried text-warning"></i> Dishes ({{ results.dishes|length }})
            </h3>
            <div class="row g-3">
                {% for dish in results.dishes %}
                <div class="col-lg-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <span class="badge bg-warning text-dark">Episode {{ dish.episode_number }}</span>
                                <span class="badge bg-{{ 'primary' if dish.chef_type == 'iron_chef' else 'success' }}">
                                    {{ 'Iron Chef' if dish.chef_type == 'iron_chef' else 'Competitor' }}
                                </span>
                            </div>
                            <h5 class="card-title">{{ dish.title }}</h5>
                            {% if dish.description %}
                            <p class="text-muted small mb-2">{{ dish.description[:150] }}{% if dish.description|length > 150 %}...{% endif %}</p>
                            {% endif %}
                            <small class="text-muted d-block mb-3">
                                <i class="bi bi-tag"></i> Theme: {{ dish.theme }}
                            </small>
                            <a href="{{ url_for('episode_detail', episode_id=dish.id) }}" 
                               class="btn btn-outline-warning btn-sm">
                                <i class="bi bi-eye"></i> View Episode
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Recipes Results -->
    {% if results.recipes %}
    <div class="row mb-5">
        <div class="col">
            <h3 class="h4 mb-3">
                <i class="bi bi-book text-success"></i> Recipes ({{ results.recipes|length }})
            </h3>
            <div class="row g-3">
                {% for recipe in results.recipes %}
                <div class="col-lg-6">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <span class="badge bg-success">Episode {{ recipe.episode_number }}</span>
                                <small class="text-muted">Recipe</small>
                            </div>
                            <h5 class="card-title">{{ recipe.title }}</h5>
                            {% if recipe.description %}
                            <p class="text-muted small mb-2">{{ recipe.description }}</p>
                            {% endif %}
                            <small class="text-muted d-block mb-3">
                                <i class="bi bi-tag"></i> Theme: {{ recipe.theme }}
                            </small>
                            <a href="{{ url_for('recipe_detail', recipe_id=recipe.id) }}" 
                               class="btn btn-outline-success btn-sm">
                                <i class="bi bi-book"></i> View Recipe
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    
    {% elif query %}
    <!-- No Results -->
    <div class="row">
        <div class="col">
            <div class="text-center py-5">
                <i class="bi bi-search display-1 text-muted"></i>
                <h3 class="mt-3">No results found</h3>
                <p class="text-muted">
                    No episodes, dishes, or recipes match your search for "<strong>{{ query }}</strong>".
                </p>
                <div class="mt-4">
                    <h5>Search Tips:</h5>
                    <ul class="list-unstyled text-muted">
                        <li><i class="bi bi-check"></i> Try different keywords or spellings</li>
                        <li><i class="bi bi-check"></i> Use broader terms (e.g., "fish" instead of "salmon")</li>
                        <li><i class="bi bi-check"></i> Search for chef names or cooking techniques</li>
                        <li><i class="bi bi-check"></i> Browse by theme or explore all episodes</li>
                    </ul>
                </div>
                <div class="d-flex gap-2 justify-content-center mt-4">
                    <a href="{{ url_for('episodes') }}" class="btn btn-primary">
                        <i class="bi bi-tv"></i> Browse Episodes
                    </a>
                    <a href="{{ url_for('recipes') }}" class="btn btn-success">
                        <i class="bi bi-book"></i> Browse Recipes
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Search Help -->
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center py-5">
                    <i class="bi bi-search display-4 text-primary mb-4"></i>
                    <h3>Search the Iron Chef Database</h3>
                    <p class="text-muted mb-4">
                        Find episodes, dishes, and recipes from Iron Chef Japan. 
                        Search by theme, chef name, ingredient, or cooking technique.
                    </p>
                    
                    <div class="row g-3 mt-4">
                        <div class="col-md-4">
                            <div class="search-example p-3 bg-light rounded">
                                <i class="bi bi-tag text-primary"></i>
                                <h6 class="mt-2">By Theme</h6>
                                <small class="text-muted">
                                    "lobster", "beef", "dessert"
                                </small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="search-example p-3 bg-light rounded">
                                <i class="bi bi-person text-success"></i>
                                <h6 class="mt-2">By Chef</h6>
                                <small class="text-muted">
                                    "Morimoto", "Sakai", chef names
                                </small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="search-example p-3 bg-light rounded">
                                <i class="bi bi-egg text-warning"></i>
                                <h6 class="mt-2">By Ingredient</h6>
                                <small class="text-muted">
                                    "soy sauce", "ginger", "miso"
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{{ url_for('episodes') }}" class="btn btn-outline-primary me-2">
                            <i class="bi bi-tv"></i> Browse All Episodes
                        </a>
                        <a href="{{ url_for('recipes') }}" class="btn btn-outline-success">
                            <i class="bi bi-book"></i> Browse All Recipes
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add hover effects to result cards
    const resultCards = document.querySelectorAll('.card');
    resultCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.transition = 'transform 0.2s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
    
    // Focus search input if no query
    const searchInput = document.querySelector('input[name="q"]');
    if (searchInput && !searchInput.value) {
        searchInput.focus();
    }
    
    // Highlight search terms in results (simple implementation)
    const query = "{{ query }}";
    if (query && query.length > 2) {
        const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        const textElements = document.querySelectorAll('.card-title, .text-muted');
        
        textElements.forEach(element => {
            if (element.textContent.toLowerCase().includes(query.toLowerCase())) {
                element.innerHTML = element.innerHTML.replace(regex, '<mark>$1</mark>');
            }
        });
    }
});
</script>
{% endblock %}